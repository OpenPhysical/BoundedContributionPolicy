name: Quality Checks

on:
  push:
    branches: [ master, main ]
  pull_request:
    branches: [ master, main ]

jobs:
  pre-commit:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.x'

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'

    - name: Install npm dependencies
      run: npm ci

    - name: Run pre-commit
      uses: pre-commit/action@v3.0.1

  verify:
    runs-on: ubuntu-latest
    needs: pre-commit

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Verify policy file exists
      run: |
        if [ ! -f "CODE_OF_CONDUCT.md" ]; then
          echo "❌ CODE_OF_CONDUCT.md (Bounded Contribution Policy) is missing"
          exit 1
        fi
        echo "✅ Bounded Contribution Policy found"

    - name: Check for broken internal links
      run: |
        echo "Checking for broken internal markdown links..."
        # Simple check for common broken link patterns
        if grep -r "\]\(.*\.md\)" . --include="*.md" | grep -E "\]\([^)]*BOUNDED_CONTRIBUTION_POLICY\.md"; then
          echo "❌ Found references to old BOUNDED_CONTRIBUTION_POLICY.md file"
          exit 1
        fi
        echo "✅ No broken internal links found"
